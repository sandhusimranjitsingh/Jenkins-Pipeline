pipeline {
    agent any
    stages {
        stage("Build") {
            steps {
                echo "Task: compile and pack the code"
                echo "Tool: Maven"
                // Your build steps here
            }
        }
        stage("Unit and Integration Tests") {
            steps {
                echo "Task: run unit tests and integration tests"
                echo "Tool: JUnit"
                // Your test execution steps here
            }
            post {
                always {
                    script {
                        // Specify the path to the build log file
                        def buildLogPath = "${env.WORKSPACE}/jenkins.log"
                        
                        // Read the build log
                        def buildLog = readFile(buildLogPath)
                        
                        // Send email with build log as attachment
                        emailext attachmentsPattern: buildLogPath, 
                            body: """<p>Stage 'Unit and Integration Tests' completed with status ${currentBuild.result}</p>
<p>Check console output at ${env.BUILD_URL} to view the results.</p>""",
                            to: "sssandhu.singh387@gmail.com", 
                            subject: "Unit and Integration Tests Status: ${currentBuild.result}"
                    }
                }
            }
        }
        stage("Code Analysis") {
            steps {
                echo "Task: perform code analysis"
                echo "Tool: Checkstyle"
                // Your code analysis steps here
            }
        }
        stage("Security Check") {
            steps {
                echo "Task: perform security scan"
                echo "Tool: SonarQube"
                // Your security scanning steps here
            }
            post {
                success {
                    emailext to: "sssandhu.singh387@gmail.com",
                        subject: "Security Check Status EMail",
                        body: "Security check was successful"
                }
                failure {
                    emailext to: "sssandhu.singh387@gmail.com",
                        subject: "Security Check Status EMail",
                        body: "Security check - Failed"
                }
            }
        }
        stage("Deploying to Staging") {
            steps {
                echo "Task: deploy to staging server"
                echo "Tool: Jenkins deployment plugins"
                // Your deployment steps here
            }
        }
        stage("Integration Tests on Staging") {
            steps {
                echo "Task: run integration tests on staging"
                echo "Tool: Selenium"
                // Your integration tests on staging steps here
            }
            post {
                success {
                    emailext to: "sssandhu.singh387@gmail.com",
                        subject: "Integration Tests on Staging Status EMail",
                        body: "Integration tests on staging were successful"
                }
                failure {
                    emailext to: "sssandhu.singh387@gmail.com",
                        subject: "Integration Tests on Staging Status EMail",
                        body: "Integration tests on staging - Failed"
                }
            }
        }
        stage("Deploying to Production") {
            steps {
                echo "Task: deploy to production server"
                echo "Tool: Jenkins deployment plugins"
                // Your deployment to production steps here
            }
        }
    }
}
